/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.m.SelectDialog");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.m.SelectDialog",{metadata:{publicMethods:["open"],library:"sap.m",properties:{"title":{type:"string",group:"Appearance",defaultValue:null},"noDataText":{type:"string",group:"Appearance",defaultValue:null},"filterPath":{type:"string",group:"Behavior",defaultValue:null},"filterOperator":{type:"string",group:"Misc",defaultValue:null},"filterValue":{type:"string",group:"Misc",defaultValue:null}},defaultAggregation:"items",aggregations:{"items":{type:"sap.m.StandardListItem",multiple:true,singularName:"item"},"_dialog":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{"close":{}}}});sap.m.SelectDialog.M_EVENTS={'close':'close'};
/*!
 * @copyright@
 */
jQuery.sap.require("sap.m.Button");jQuery.sap.require("sap.m.Dialog");jQuery.sap.require("sap.m.GrowingList");jQuery.sap.require("sap.m.SearchField");
sap.m.SelectDialog.prototype.init=function(){var t=this,l=0;this._list=new sap.m.GrowingList(this.getId()+"-list",{noDataText:this.getNoDataText(),mode:sap.m.ListMode.SingleSelectMaster,select:function(e){var s=e.getParameter("listItem");if(t._dialog){t._selectedItem=s;t._dialog.close()}}});this._busyIndicator=new sap.m.BusyIndicator(this.getId()+"-busyIndicator").addStyleClass("sapMSelectDialogBusyIndicator",true);this._searchField=new sap.m.SearchField(this.getId()+"-searchField",{liveChange:function(e){var v=e.getSource().getValue(),d=(v?300:0);clearTimeout(l);if(d){l=setTimeout(function(){t._executeSearch(v,"liveChange")},d)}else{t._executeSearch(v,"liveChange")}},search:function(e){t._executeSearch(e.getSource().getValue(),"search")}});this._subHeader=new sap.m.Bar(this.getId()+"-subHeader",{contentLeft:[this._searchField]});this._dialog=new sap.m.Dialog(this.getId()+"-dialog",{title:this.getTitle(),stretch:jQuery.device.is.phone,contentWidth:"480px",contentHeight:"2000px",subHeader:this._subHeader,content:[this._busyIndicator,this._list],leftButton:new sap.m.Button({text:"Cancel",press:function(){t._dialog.close()}}),afterClose:function(e){t.fireClose({selectedItem:t._selectedItem})}}).addStyleClass("sapMSelectDialog",true);this._dialog._iVMargin=8*parseInt(sap.ui.core.theming.Parameters.get("sapUiFontSize")||16,10);this._searchFieldValue="";this._searchFieldLastEventType="";this._firstRequest=true;this._listUpdateRequested=0};
sap.m.SelectDialog.prototype.exit=function(){delete this._list;delete this._searchField;delete this._filter;delete this._subHeader;delete this._busyIndicator;delete this._firstRequest;delete this._listUpdateRequested;delete this._searchFieldValue;delete this._searchFieldLastEventType;if(this._dialog){this._dialog.destroy();this._dialog=null}};
sap.m.SelectDialog.prototype.open=function(){var u=(this.getFilterValue()!==this._searchField.getValue());sap.ui.getCore().getEventBus().publish("nav","virtual");this._list.removeSelections();delete this._selectedItem;this._searchFieldLastEventType="";this._firstRequest=true;this._listUpdateRequested=0;if(u){this._searchField.setValue(this.getFilterValue())}this._dialog.open();if(u){this._executeSearch()}};
sap.m.SelectDialog.prototype.setTitle=function(t){this._dialog.setTitle(t);this.setProperty("title",t,true)};
sap.m.SelectDialog.prototype.setNoDataText=function(n){this._list.setNoDataText(n);this.setProperty("noDataText",n,true)};
sap.m.SelectDialog.prototype.setFilterPath=function(f){this.setProperty("filterPath",f,true);this._executeSearch()};
sap.m.SelectDialog.prototype.setFilterOperator=function(f){this.setProperty("filterOperator",f,true);this._executeSearch()};
sap.m.SelectDialog.prototype.setFilterValue=function(f){if(this._dialog.isOpen()){this._searchField.setValue(f)}this.setProperty("filterValue",f,true);this._executeSearch()};
sap.m.SelectDialog.prototype._setModel=sap.m.SelectDialog.prototype.setModel;
sap.m.SelectDialog.prototype.setModel=function(m,n){var a=Array.prototype.slice.call(arguments),r;r=this._list.setModel(m,n);this._listUpdateRequested+=1;m.attachRequestSent(this._requestSent,this);m.attachRequestCompleted(this._requestCompleted,this);return r&&sap.m.SelectDialog.prototype._setModel.apply(this,a)};
sap.m.SelectDialog.prototype._callMethodInManagedObject=function(f,a){var b=Array.prototype.slice.call(arguments);if(a==="items"){return this._list[f].apply(this._list,b.slice(1))}else{return sap.ui.base.ManagedObject.prototype[f].apply(this,b.slice(1))}};
sap.m.SelectDialog.prototype.bindAggregation=function(n,b){var a=Array.prototype.slice.call(arguments),r;r=this._callMethodInManagedObject.apply(this,["bindAggregation"].concat(a));if(n==="items"&&this.getFilterValue()){this._executeSearch()}return r};
sap.m.SelectDialog.prototype.validateAggregation=function(a,o,m){return this._callMethodInManagedObject("validateAggregation",a,o,m)};
sap.m.SelectDialog.prototype.setAggregation=function(a,o,s){this._callMethodInManagedObject("setAggregation",a,o,s);return this};
sap.m.SelectDialog.prototype.getAggregation=function(a,d){return this._callMethodInManagedObject("getAggregation",a,d)};
sap.m.SelectDialog.prototype.indexOfAggregation=function(a,o){return this._callMethodInManagedObject("indexOfAggregation",a,o)};
sap.m.SelectDialog.prototype.insertAggregation=function(a,o,i,s){this._callMethodInManagedObject("insertAggregation",a,o,i,s);return this};
sap.m.SelectDialog.prototype.addAggregation=function(a,o,s){this._callMethodInManagedObject("addAggregation",a,o,s);return this};
sap.m.SelectDialog.prototype.removeAggregation=function(a,o,s){return this._callMethodInManagedObject("removeAggregation",a,o,s)};
sap.m.SelectDialog.prototype.removeAllAggregation=function(a,s){return this._callMethodInManagedObject("removeAllAggregation",a,s)};
sap.m.SelectDialog.prototype.destroyAggregation=function(a,s){this._callMethodInManagedObject("destroyAggregation",a,s);return this};
sap.m.SelectDialog.prototype._executeSearch=function(v,e){var l=this._list,a=(l?l.getBinding("items"):undefined),f=[],s,b=(this._searchFieldValue!==v),c=(v!==undefined?v:this.getFilterValue());if(this._dialog.isOpen()&&(b||this._searchFieldLastEventType!=="liveChange"&&e==="search")){this._searchFieldValue=c;if(c){s=new sap.ui.model.Filter(this.getFilterPath(),this.getFilterOperator(),c);f.push(s)}if(a){this._listUpdateRequested+=1;a.filter(f)}}this._searchFieldLastEventType=e};
sap.m.SelectDialog.prototype._requestSent=function(e){if(this._dialog.isOpen()&&this._listUpdateRequested){if(this._firstRequest){this._subHeader.$().css('display','none')}this._list.addStyleClass('sapMSelectDialogListHide');this._busyIndicator.$().css('display','inline-block')}};
sap.m.SelectDialog.prototype._requestCompleted=function(e){if(this._dialog.isOpen()&&this._listUpdateRequested){if(this._firstRequest){this._subHeader.$().css('display','block');this._firstRequest=false}this._list.removeStyleClass('sapMSelectDialogListHide');this._busyIndicator.$().css('display','none');this._listUpdateRequested-=1}};
