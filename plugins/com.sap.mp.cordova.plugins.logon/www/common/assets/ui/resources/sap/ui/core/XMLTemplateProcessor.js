/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.core.XMLTemplateProcessor");(function(){function p(t,v,n,c){var b=sap.ui.base.ManagedObject.bindingParser(v,c);if(b){return b}var T=sap.ui.base.DataType.getType(t);if(T){if(T instanceof sap.ui.base.DataType){return T.parseValue(v)}}else{throw new Error("Property "+n+" has no known type")}return v}function l(x){return x.localName||x.baseName||x.nodeName}sap.ui.core.XMLTemplateProcessor={};sap.ui.core.XMLTemplateProcessor.loadTemplate=function(t,e){e=e||"view";var u=jQuery.sap.getModulePath(t,"."+e+".xml");var r=jQuery.sap.sjax({url:u,dataType:'xml'});var _=r.data;if(!_){throw new Error("UI definition could not be loaded from "+u+". Check for XML errors or 'file not found' errors.")}return _.documentElement};sap.ui.core.XMLTemplateProcessor.parseViewAttributes=function(x,v,s){var a=v.getMetadata().getAllProperties();for(var i=0;i<x.attributes.length;i++){var b=x.attributes[i];if(b.name==='controllerName'){v._controllerName=b.value}else if(b.name==='resourceBundleName'){v._resourceBundleName=b.value}else if(b.name==='resourceBundleUrl'){v._resourceBundleUrl=b.value}else if(b.name==='resourceBundleLocale'){v._resourceBundleLocale=b.value}else if(b.name==='resourceBundleAlias'){v._resourceBundleAlias=b.value}else if(!s[b.name]&&a[b.name]){s[b.name]=p(a[b.name].type,b.value,b.name,v._oContainingView.oController)}}};sap.ui.core.XMLTemplateProcessor.parseTemplate=function(x,v){var r=[];if(v.isSubView()){a(x,true)}else{b(x)}return r;function a(x,R){if(x.nodeType===1){var L=l(x);if(x.namespaceURI==="http://www.w3.org/1999/xhtml"||x.namespaceURI==="http://www.w3.org/2000/svg"){r.push("<"+L+" ");var I;for(var i=0;i<x.attributes.length;i++){var e=x.attributes[i];var g=e.value;if(e.name==="id"){g=v._oContainingView.createId(g)}r.push(e.name+"=\""+jQuery.sap.encodeHTML(g)+"\" ")}if(R===true){r.push("data-sap-ui-preserve"+"=\""+v.getId()+"\" ")}r.push(">");b(x);r.push("</"+L+">")}else{var C=d(x);if(v.getMetadata().hasAggregation("content")){v.addAggregation("content",C)}else if(v.getMetadata().hasAssociation(("content"))){v.addAssociation("content",C)}r.push(C)}}else if(x.nodeType===3){var t=x.textContent||x.text,h=l(x.parentNode);if(t){if(h!="style"){t=jQuery.sap.encodeHTML(t)}r.push(t)}}}function b(x,R){var e=x.childNodes;for(var i=0;i<e.length;i++){a(e[i],R)}}function f(n,L){var C;var m=sap.ui.getCore().getLoadedLibraries();jQuery.each(m,function(s,o){if(n===o.namespace||n===o.name){C=o.name+"."+((o.tagNames&&o.tagNames[L])||L)}});C=C||n+"."+L;jQuery.sap.require(C);return jQuery.sap.getObject(C)}function c(n){if(n.namespaceURI==="http://www.w3.org/1999/xhtml"||n.namespaceURI==="http://www.w3.org/2000/svg"){var i=n.attributes['id']?n.attributes['id'].textContent||n.attributes['id'].text:null;return new sap.ui.core.mvc.XMLView({id:i?v._oContainingView.createId(i):undefined,xmlNode:n,containingView:v._oContainingView})}else{return d(n)}}function d(n){var e=n.namespaceURI,C=f(e,l(n)),m=C.getMetadata(),j=m.getJSONKeys(),s={},S="",g=[];for(var i=0;i<n.attributes.length;i++){var h=n.attributes[i];var N=h.name;var V=h.value;var I=j[N];if(N==="id"){s[N]=v.createId(V)}else if(N==="class"){S+=V}else if(N==="viewName"){s[N]=V}else if(N==="fragmentName"){s[N]=V;s['containingView']=v._oContainingView}else if(N.indexOf(":")>-1){if(h.namespaceURI==="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"){var L=l(h);g.push(new sap.ui.core.CustomData({key:L,value:p("any",V,L,v._oContainingView.oController)}))}else{jQuery.sap.log.warning(v+": XMLView parser encountered and ignored attribute '"+N+"' (value: '"+V+"') with unknown namespace")}}else if(I&&I._iKind===0){s[N]=p(I.type,V,N,v._oContainingView.oController)}else if(I&&I._iKind===1&&I.altTypes){s[N]=p(I.altTypes[0],V,N,v._oContainingView.oController)}else if(I&&I._iKind===2){var B=sap.ui.base.ManagedObject.bindingParser(V,v._oContainingView.oController);if(B){s[N]=B}else{jQuery.sap.log.error(v+": aggregations with cardinality 0..n only allow binding paths as attribute value (wrong value: "+N+"='"+V+"')")}}else if(I&&I._iKind===3){s[N]=v.createId(V)}else if(I&&I._iKind===4){s[N]=jQuery.map(V.split(/[\s,]+/g),function(t){return t?v.createId(t):null})}else if(I&&I._iKind===5){var E=v._oContainingView.oController[V];if(typeof(E)!=="function"){jQuery.sap.log.warning(v+": event handler function \""+V+"\" is not a function or does not exist in the controller.")}if(E){E["_sapui_handlerName"]=V;s[N]=[E,v._oContainingView.oController]}}else{jQuery.sap.log.warning(v+": XMLTemplateProcessor encountered and ignored unknown attribute '"+N+"' (value: '"+V+"')")}}if(g.length>0){s.customData=g}function k(n,A,o){var t,u;for(t=n.firstChild;t;t=t.nextSibling){if(t.nodeType===1){u=t.namespaceURI===e&&o&&o[l(t)];if(u){k(t,u)}else if(A){var q=c(t);if(q){var w=A._sName;if(A.multiple){if(!s[w]){s[w]=[]}if(typeof s[w].path==="string"){s[w].template=q}else{s[w].push(q)}}else{s[w]=q}}else{throw new Error("Cannot add direct child without default aggregation defined for control "+m.getElementName())}}}else if(t.nodeType===3){if(jQuery.trim(t.textContent||t.text)){throw new Error("Cannot add text nodes as direct child of an aggregation. For adding text to an aggregation, a surrounding html tag is needed")}}}}var A=m.getDefaultAggregation();var o=m.getAllAggregations();k(n,A,o);var q=new C(s);if(S&&q.addStyleClass){q.addStyleClass(S)}return q}}}());
